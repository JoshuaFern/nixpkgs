From f39be5fdee97ef4a0cbf608d6ab45e81b57bb49d Mon Sep 17 00:00:00 2001
From: Will Dietz <w@wdtz.org>
Date: Thu, 18 Oct 2018 09:17:37 -0500
Subject: [PATCH 1/3] convert 'inbox' tag to single-char indicator, hide
 'important'

---
 src/index_view.m   |  9 ++++++++-
 src/tags.m         | 14 ++++++++++++--
 src/thread_pager.m |  9 ++++++++-
 3 files changed, 28 insertions(+), 4 deletions(-)

diff --git a/src/index_view.m b/src/index_view.m
index b176f25..45eb289 100644
--- a/src/index_view.m
+++ b/src/index_view.m
@@ -1774,7 +1774,7 @@ draw_index_line(IAttrs, Panel, Line, _LineNr, IsCursor, !IO) :-
     ),
     mattr(Panel, unless(IsCursor, Attrs ^ standard_tag), !IO),
 
-    StdTags = standard_tags(Unread, Replied, Deleted, Flagged),
+    StdTags = standard_tags(Unread, Replied, Deleted, Flagged, Inboxed),
     (
         Unread = unread,
         Base = bold,
@@ -1798,6 +1798,13 @@ draw_index_line(IAttrs, Panel, Line, _LineNr, IsCursor, !IO) :-
         Deleted = not_deleted,
         draw(Panel, " ", !IO)
     ),
+    (
+        Inboxed = inboxed,
+        draw(Panel, "i", !IO)
+    ;
+        Inboxed = not_inboxed,
+        draw(Panel, " ", !IO)
+    ),
     (
         Flagged = flagged,
         mattr_draw(Panel, unless(IsCursor, Attrs ^ flagged), "! ", !IO)
diff --git a/src/tags.m b/src/tags.m
index d933142..da8fb33 100644
--- a/src/tags.m
+++ b/src/tags.m
@@ -29,12 +29,17 @@
     --->    flagged
     ;       unflagged.
 
+:- type inboxed
+    --->    inboxed
+    ;       not_inboxed.
+
 :- type standard_tags
     --->    standard_tags(
                 unread :: unread,
                 replied :: replied,
                 deleted :: deleted,
-                flagged :: flagged
+                flagged :: flagged,
+                inboxed :: inboxed
             ).
 
 :- type tag_delta
@@ -88,11 +93,14 @@ nondisplay_tag(tag("replied")).
 nondisplay_tag(tag("sent")).
 nondisplay_tag(tag("signed")).
 nondisplay_tag(tag("unread")).
+nondisplay_tag(tag("important")).
+nondisplay_tag(tag("inbox")).
 
 %-----------------------------------------------------------------------------%
 
 get_standard_tags(Tags, StdTags, DisplayTagsWidth) :-
-    StdTags0 = standard_tags(read, not_replied, not_deleted, unflagged),
+    StdTags0 = standard_tags(read, not_replied, not_deleted, unflagged,
+        not_inboxed),
     set.fold2(get_standard_tags_2, Tags, StdTags0, StdTags,
         0, DisplayTagsWidth).
 
@@ -108,6 +116,8 @@ get_standard_tags_2(Tag, !StdTags, !DisplayTagsWidth) :-
         !StdTags ^ deleted := deleted
     ; Tag = tag("flagged") ->
         !StdTags ^ flagged := flagged
+    ; Tag = tag("inbox") ->
+        !StdTags ^ inboxed := inboxed
     ; display_tag(Tag) ->
         Tag = tag(TagName),
         % Add one for separator.
diff --git a/src/thread_pager.m b/src/thread_pager.m
index 667e644..d27a47a 100644
--- a/src/thread_pager.m
+++ b/src/thread_pager.m
@@ -2863,7 +2863,7 @@ draw_thread_line(TAttrs, Panel, Line, _LineNr, IsCursor, !IO) :-
     ),
     mattr(Panel, unless(IsCursor, Attrs ^ standard_tag), !IO),
 
-    StdTags = standard_tags(Unread, Replied, Deleted, Flagged),
+    StdTags = standard_tags(Unread, Replied, Deleted, Flagged, Inboxed),
     (
         Unread = unread,
         draw(Panel, "n", !IO)
@@ -2885,6 +2885,13 @@ draw_thread_line(TAttrs, Panel, Line, _LineNr, IsCursor, !IO) :-
         Deleted = not_deleted,
         draw(Panel, " ", !IO)
     ),
+    (
+        Inboxed = inboxed,
+        draw(Panel, "i", !IO)
+    ;
+        Inboxed = not_inboxed,
+        draw(Panel, " ", !IO)
+    ),
     (
         Flagged = flagged,
         mattr_draw(Panel, unless(IsCursor, Attrs ^ flagged), "! ", !IO)
-- 
2.20.1

